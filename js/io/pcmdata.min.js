/*
pcmdata.js
Uses binary.js and stream.js to parse PCM wave data.
On GitHub:
 * pcmdata.js	http://goo.gl/4uu06
 * binary.js	http://goo.gl/ZaWqK

binary.js repository also includes stream.js

MIT License
*/


(function(b,c){var j=String.fromCharCode,h=true,d=false;function g(k,l){return l?j(k&255)+g(k>>8,l-1):""}function e(k,l){return l?e(k>>8,l-1)+j(255-k&255):""}function i(k,l,m){return m?e(k,l):g(k,l)}function a(r,q){var k=r.length,p=k-1,s=0,o=c.pow,m;if(q){for(m=0;m<k;m++){s+=(255-r.charCodeAt(m))*o(256,p-m)}}else{for(m=0;m<k;m++){s+=r.charCodeAt(m)*o(256,m)}}return s}function f(p,t,o,x){var s=c.pow,r=c.floor,m=f.convertFromBinary,u=f.convertToBinary,k=p/8,q=s(2,p),w=q/2,l=w-0.5,y=w-1,v=1/l,n=1/y;return x?o?t?function(z,A){z=r(z*y);return u(z<0?w-z:z,k,A)}:function(z,A){return u(r(z*y),k,A)}:t?function(z,A){return u(z<0?y-z:z,k,A)}:function(z,A){return u(z,k,A)}:o?t?function(B,A){var z=m(B,A);return z>l?(l-z)*v:z*n}:function(A,z){return m(A,z)*n}:t?function(B,A){var z=m(B,A);return z>y?y-z:z}:function(A,z){return m(A,z)}}f.convertToBinary=i;f.convertFromBinary=a;f.fromFloat32=f(32,h,h,h);f.toFloat32=f(32,h,h,d);f.fromInt32=f(32,h,d,h);f.toInt32=f(32,h,d,d);f.fromInt24=f(24,h,d,h);f.toInt24=f(24,h,d,d);f.fromInt16=f(16,h,d,h);f.toInt16=f(16,h,d,d);f.fromInt8=f(8,h,d,h);f.toInt8=f(8,h,d,d);f.fromUint32=f(32,d,d,h);f.toUint32=f(32,d,d,d);f.fromUint16=f(16,d,d,h);f.toUint16=f(16,d,d,d);f.fromUint8=f(8,d,d,h);f.toUint8=f(8,d,d,d);b.Binary=f}(this,Math));(function(e,f){function g(h){this.data=h}var d=g.prototype={read:function(i){var h=this,j=h.data.substr(0,i);h.data=h.data.substr(i);h.pointer+=i;return j}},c,b;function a(k,i,j){var h=i/8;d["read"+k+i]=function(){return j(this.read(h))}}for(c in f){b=/to([a-z]+)([0-9]+)/i.exec(c);b&&a(b[1],b[2],f[c])}e.Stream=g;g.newType=a}(this,this.Binary));this.PCMData=(function(a,b){function c(d){return(typeof d==="string"?c.decode:c.encode)(d)}c.decode=function(D){var g=new b(D),o=g.read(4),v=g.readUint32();g=new b(g.read(v));var k=g.read(4),n=g.read(4),t=g.readUint32(),d=new b(g.read(t)),f=d.readUint16(),y=d.readUint16(),B=d.readUint32(),h=d.readUint32(),A=d.readUint16(),z=A/y,m=t===16?d.readUint16():d.readUint32(),l="readInt"+(z*8),q=1/Math.pow(2,z*8-1),e,p,r,w,C,u,j,x,s={};while(g.data){e=g.read(4);p=g.readUint32();w=g.read(p);j=s[e]=s[e]||[];if(e==="data"){r=~~(p/z);C=new b(w);u=(typeof Float32Array!=="undefined"?Float32Array:Array)(r);for(x=0;x<r;x++){u[x]=C[l]()*q}}else{j.push(w)}}return{channelCount:y,bytesPerSample:A/y,sampleRate:h/A,chunks:s,data:u}};c.encode=function(x){var s=a.fromUint32,y=a.fromUint16,p=x.data,e=x.sampleRate,j=x.channelCount||1,u=x.bytesPerSample||1,k=u*8,g=j*u,v=e*g,h=p.length,f=h*u,o=Math.pow(2,k-1)-1,d=a["fromInt"+k],m=[],l="",w,t,q,r;m.push("fmt "+s(16)+y(1)+y(j)+s(e)+s(v)+y(g)+y(k));for(t=0;t<h;t++){l+=d(p[t]*o)}m.push("data"+s(f)+l);r=x.chunks;if(r){for(t in r){if(r.hasOwnProperty(t)){w=r[t];for(q=0;q<w.length;q++){l=w[q];m.push(t+s(l.length)+l)}}}}m=m.join("");return"RIFF"+s(m.length)+"WAVE"+m};return c}(this.Binary,this.Stream));
